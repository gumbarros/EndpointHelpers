# AGENTS.md

Guidance for coding agents working in this repository.

## Scope

- Applies to the full repository.
- Follow these instructions for code changes, tests, and generated-output behavior.

## Project layout

- `src/EndpointHelpers`: Roslyn source generators.
- `test/EndpointHelpers.Tests`: xUnit tests that assert generated source.
- `example/EndpointHelpers.Sample`: sample MVC app using the generators.

## Build and test

- Restore: `dotnet restore`
- Build generator project: `dotnet build src/EndpointHelpers/EndpointHelpers.csproj`
- Run all tests: `dotnet test test/EndpointHelpers.Tests/EndpointHelpers.Tests.csproj`
- Run a subset: `dotnet test test/EndpointHelpers.Tests/EndpointHelpers.Tests.csproj --filter <TestName>`

## Generator conventions

- Common behavior lives in `src/EndpointHelpers/ControllerGeneratorBase.cs`.
- Generator implementations should define attribute names and output filename via overrides.
- Generator implementations should emit deterministic source text (stable ordering and formatting).
- Generator implementations should include `// <auto-generated/>` and `#nullable enable` in generated files.
- Generator implementations should use fully qualified attribute names in generated output (for example `global::JetBrains.Annotations...`).

## JetBrains annotations

- Any JetBrains MVC annotations must be emitted conditionally.
- Detect availability through `compilation.GetTypeByMetadataName(...)`.
- Only emit attributes where their `AttributeUsage` permits.

## Tests

- Prefer focused string-based assertions against generated files.
- Keep formatting-sensitive expectations in mind; small formatting changes can break tests.
- When testing optional dependencies (for example JetBrains annotations), provide stub attribute definitions in test source.
- For mixed sources in generator tests, prefer separate syntax trees instead of concatenating unrelated source blocks.

## Change hygiene

- Do not edit `bin/` or `obj/` outputs.
- Keep changes minimal and targeted to the requested behavior.
- If generator surface changes, update tests and sample project in the same change
- If public behavior or setup changes, update `README.md`.
